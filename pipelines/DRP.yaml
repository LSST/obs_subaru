description: The DRP pipeline specialized for the HSC instrument
instrument: lsst.obs.subaru.HyperSuprimeCam
imports:
  - $PIPE_TASKS_DIR/pipelines/DRP.yaml
tasks:
  skyCorr:
    class: lsst.pipe.drivers.skyCorrection.SkyCorrectionTask
  jointcal:
    # The jointcal package depends on obs_subaru, not the other way around, so
    # it's not great to have this here, but it's the least-bad temporary spot
    # for this information (which is specific to both Gen3 and HSC) until we
    # RFC-approve a better home for it.
    class: lsst.jointcal.JointcalTask
    config:
      python: |
        # This override is temporary until DM-29008.
        from lsst.utils import getPackageDir
        config.load(os.path.join(getPackageDir("jointcal"), "tests", "config", "config-gen3.py"))
  makeWarp:
    class: lsst.pipe.tasks.makeCoaddTempExp.MakeWarpTask
    config:
      python: >
        from lsst.pipe.tasks.selectImages import PsfWcsSelectImagesTask;
        config.select.retarget(PsfWcsSelectImagesTask)
  forcedPhotCcd:
    class: lsst.meas.base.forcedPhotCcd.ForcedPhotCcdTask
    config:
      # The application of external calibrations doesn't work with Gen3 now (DM-17062)
      doApplyExternalPhotoCalib: false
      doApplyExternalSkyWcs: false
      doApplySkyCorr: false
subsets:
  multiVisit:
    subset:
      - jointcal
      - makeWarp
      - assembleCoadd
      - detection
      - mergeDetections
      - deblend
      - measure
      - mergeMeasurements
      - forcedPhotCcd
      - forcedPhotCoadd
      - transformObjectTable
      - writeObjectTable
      - consolidateObjectTable
    description: >
      All tasks that process multiple visits together.
      This subset plus singleFrame should generally be equivalent to the full
      pipeline.  At present this is not true, because diffimDRP would benefit
      from more testing before we start running it with everything else by
      default.
